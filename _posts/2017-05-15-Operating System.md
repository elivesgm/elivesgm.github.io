---
layout: post
title: "Operating System"
date: 2017-05-15 23:15:06 
description: "Operating System"
tag: Operating System
---

### 0 国内外现状

- MIT XV6 JOS


### 1 操作系统基础
主要关注x86-32，即80386。

#### 1.1 x86-32硬件 运行模式

有四种运行模式：**实模式**、**保护模式**、**SMM模式**和**虚拟8086模式**。

- **实模式**，80386加电启动后处于实模式运行状态，在这种状态下软件可以访问的物理内存空间不能超过1MB，且无法发挥Intel 80386以上级别的32为CPU的4GB内存管理能力。早期DOS就运行在实模式。
- **保护模式**，支持内存分页机制，提供了对虚拟内存的良好支持。保护模式下80386支持多任务，还支持有限级机制，不同的程序可以运行在不同的优先级上。优先级一共分为0~34个级别，操作系统运行在最高的优先级0上，应用程序则运行在比较低的级别上；配合良好的检查机制后，既可以在任务间实现数据的安全共享也可以很好地隔离各个任务。

#### 1.2 x86-32硬件 内存架构

- 地址是访问内存空间的索引。
- 80386是32位的处理器，可以寻址的物理内存地址空间为2^32=4G字节。
- 物理内存地址空间是处理器提交到总线上用于访问计算机系统中的内存和外设的最终地址。一个计算机系统中只有一个物理地址空间。
- 线性地址空间是在操作系统的虚存管理之下内个运行的应用程序能访问的地址空间。每个运行的应用程序都认为自己独享整个计算机系统的地址空间，这样可让多个运行的应用程序之间相互隔离。
- 逻辑地址空间，是应用程序直接使用的地址空间。

    操作系统段机制启动、页机制未启动：逻辑地址->段机制处理->线性地址=物理地址
    操作系统段机制和页机制都启动：逻辑地址->段机制处理->线性地址->页机制处理->物理地址

#### 1.3 x86-32硬件 寄存器

80386寄存器可以分为8组：

- 通用寄存器
- 段寄存器
- 指令指针寄存器
- 标志寄存器
- 控制寄存器
- 系统地址寄存器，调试寄存器，测试寄存器

##### a. 通用寄存器
- EAX: 累加器 add
- EBX: 基址寄存器 base
- ECX: 计数器 count
- EDX: 数据寄存器 data
- ESI: 源地址指针寄存器 source
- EDI: 目的地址指针寄存器 destination
- EBP: 基址指针寄存器 base pointer
- ESP: 堆栈指针寄存器 stack pointer

##### b. 段寄存器

主要用于寻址

- CS: 代码段(code segment)
- DS: 数据段(data segment)
- ES: 附加数据段(extra segment)
- SS: 堆栈段(stack segment)
- FS: 附加段
- GS: 附加段

##### c. 指令寄存器和标志寄存器
- EIP： 指令寄存器， 低16位就是8086的IP，存储的是下一条要执行的指令的内存地址，在分段地址转换中，表示指令的段内偏移地址。
- EFLAGS: 标志寄存器，IF（Interrupt Flag）为中断允许标志位由CLI，STI两条指令来控制；设置IF使CPU可识别外部（可屏蔽）中断请求。复位IF则禁止中断。IF对不可屏蔽外部中断和故障中断的识别没有任何作用。CF,PF,ZF...

